<div class="login-container">
    <!-- Loading Overlay with ngx-spinner -->
    <ngx-spinner name="auth-spinner" type="ball-clip-rotate" size="medium" bdColor="rgba(0, 0, 0, 0.8)">
        <p class="loading-message">{{ mode === 'login' ? 'Signing in...' : 'Creating account...' }}</p>
    </ngx-spinner>

    <mat-card>
        <h3>{{ mode === 'login' ? 'Welcome Back' : 'Create Account' }}</h3>
        <form [formGroup]="form" (ngSubmit)="onSubmit()" autocomplete="off">
            <!-- Username -->
            <div class="field-wrapper">
                <mat-form-field appearance="outline" [class.error-field]="errorMsg.username()">
                    <mat-label>Username</mat-label>
                    <input matInput type="text" formControlName="username" placeholder="Enter your username"
                        (blur)="mode === 'regis' && updateErrorMsg('username')">
                </mat-form-field>
                @if (errorMsg.username()) {
                <p class="error-label"><span class="error-icon">⊗</span> {{ errorMsg.username() }}</p>
                }
            </div>

            <!-- AKA / Display Name (Register only) -->
            @if (mode === 'regis') {
            <div class="field-wrapper">
                <mat-form-field appearance="outline" [class.error-field]="errorMsg.displayName()">
                    <mat-label>aka</mat-label>
                    <input matInput type="text" formControlName="displayName" placeholder="aka"
                        (blur)="updateErrorMsg('displayName')">
                </mat-form-field>
                @if (errorMsg.displayName()) {
                <p class="error-label"><span class="error-icon">⊗</span> {{ errorMsg.displayName() }}</p>
                }
            </div>
            }

            <!-- Password -->
            <div class="field-wrapper">
                <mat-form-field appearance="outline" [class.error-field]="errorMsg.password()">
                    <mat-label>Password</mat-label>
                    <input matInput type="password" formControlName="password" placeholder="Enter your password"
                        (blur)="mode === 'regis' && updateErrorMsg('password')">
                </mat-form-field>
                @if (errorMsg.password()) {
                <p class="error-label"><span class="error-icon">⊗</span> {{ errorMsg.password() }}</p>
                }
            </div>

            <!-- Confirm Password (Register only) -->
            @if (mode === 'regis') {
            <div class="field-wrapper">
                <mat-form-field appearance="outline" [class.error-field]="errorMsg.cf_password()">
                    <mat-label>Confirm Password</mat-label>
                    <input matInput type="password" formControlName="cf_password" placeholder="Confirm your password"
                        (blur)="updateErrorMsg('cf_password')">
                </mat-form-field>
                @if (errorMsg.cf_password()) {
                <p class="error-label"><span class="error-icon">⊗</span> {{ errorMsg.cf_password() }}</p>
                }
            </div>
            }

            <button mat-flat-button class="blue" type="submit" [disabled]="isLoading()">
                @if (isLoading()) {
                <mat-spinner diameter="20" strokeWidth="2"></mat-spinner>
                <span class="btn-loading-text">{{ mode === 'login' ? 'Signing in...' : 'Creating...' }}</span>
                } @else {
                {{ mode === 'login' ? 'Login' : 'Sign Up' }}
                }
            </button>
        </form>

        <div class="login-spacer">or</div>

        <p class="toggle">
            @if (mode === 'login') {
            Don't have an account? <span (click)="toggleMode()">Sign up</span>
            } @else {
            Already have an account? <span (click)="toggleMode()">Login</span>
            }
        </p>
    </mat-card>
</div>