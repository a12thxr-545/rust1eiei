<div class="missions-page">
    <!-- Header -->
    <div class="page-header">
        <h1>Missions</h1>
        <p>Explore and manage your space missions</p>
    </div>

    <!-- Tabs -->
    <div class="tabs-container">
        <div class="tabs">
            <button class="tab" [class.active]="selectedTabIndex === 0" (click)="onTabChange(0)">
                <span>Explore</span>
                @if (missions().length > 0) {
                <span class="badge">{{ missions().length }}</span>
                }
            </button>
            <button class="tab" [class.active]="selectedTabIndex === 1" (click)="onTabChange(1)">
                <span>Participating</span>
                @if (joinedMissions().length > 0) {
                <span class="badge joined">{{ joinedMissions().length }}</span>
                }
            </button>
            <button class="tab" [class.active]="selectedTabIndex === 2" (click)="onTabChange(2)">
                <span>My Missions</span>
                @if (myMissions().length > 0) {
                <span class="badge my">{{ myMissions().length }}</span>
                }
            </button>
            <button class="tab" [class.active]="selectedTabIndex === 3" (click)="onTabChange(3)">
                <span>History</span>
                @if (finishedMissions().length > 0) {
                <span class="badge history">{{ finishedMissions().length }}</span>
                }
            </button>
        </div>


        <!-- Tab Content -->
        <div class="tab-content">
            <!-- Other Missions -->
            @if (selectedTabIndex === 0) {
            <div class="search-container">
                <div class="search-row">
                    <!-- Search Box -->
                    <div class="search-box">
                        <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8" />
                            <path d="m21 21-4.35-4.35" />
                        </svg>
                        <input type="text" [ngModel]="searchQuery()" (ngModelChange)="searchQuery.set($event)"
                            placeholder="Search by name or Room ID...">
                        @if (searchQuery()) {
                        <button class="search-clear-btn" (click)="searchQuery.set('')" title="Clear search">×</button>
                        }
                    </div>

                    <!-- Filter Button -->
                    <button class="filter-toggle-btn" [class.has-filter]="activeFilterCount() > 0"
                        (click)="showFilterPanel.set(!showFilterPanel())">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3" />
                        </svg>
                        Filter
                        @if (activeFilterCount() > 0) {
                        <span class="filter-badge">{{ activeFilterCount() }}</span>
                        }
                    </button>
                </div>

                <!-- Filter Panel (inline, below search row) -->
                @if (showFilterPanel()) {
                <div class="filter-panel">
                    <div class="filter-panel-header">
                        <span class="filter-panel-title">Filter Missions</span>
                        @if (activeFilterCount() > 0) {
                        <button class="clear-filter-btn" (click)="clearFilters()">✕ Clear all</button>
                        }
                    </div>

                    <!-- Name prefix text input -->
                    <div class="filter-section">
                        <span class="filter-label">Name starts with</span>
                        <div class="filter-input-wrap">
                            <input class="filter-text-input" type="text" maxlength="20" [ngModel]="filterLetter()"
                                (ngModelChange)="filterLetter.set($event)" placeholder="e.g. A, Au, Audit...">
                            @if (filterLetter()) {
                            <button class="search-clear-btn" (click)="filterLetter.set('')">×</button>
                            }
                        </div>
                    </div>

                    <!-- Available Only -->
                    <div class="filter-section">
                        <span class="filter-label">Availability</span>
                        <button class="available-toggle" [class.active]="filterNotFull()"
                            (click)="toggleFilterNotFull()">
                            <span class="avail-dot"></span>
                            Available Only
                        </button>
                    </div>
                </div>
                }
            </div>


            @if (isLoading()) {
            <div class="loading-state">
                <div class="spinner"></div>
                <p>Loading missions...</p>
            </div>
            } @else if (filteredMissions().length === 0) {
            <div class="empty-state">
                <h3>No missions from others yet</h3>
                <p>Wait for other users to create missions!</p>
            </div>
            } @else {
            <div class="table-wrapper desktop-only">
                <table>
                    <thead>
                        <tr>
                            <th>Room ID</th>
                            <th>Mission</th>
                            <th>Status</th>
                            <th>Crew</th>
                            <th>Created</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        @for (mission of filteredMissions(); track mission.id) {
                        <tr [class.in-mission]="isInMission(mission.id)">
                            <td class="code-cell">
                                <span class="room-code">#{{ mission.code }}</span>
                            </td>
                            <td>
                                <div class="mission-cell">
                                    @if (mission.image_url) {
                                    <div class="mission-icon has-image">
                                        <img [src]="mission.image_url" alt="Mission" />
                                    </div>
                                    }
                                    <div class="mission-info">
                                        <span class="name">{{ mission.name }}</span>
                                        <span class="desc">{{ mission.description || 'No description' }}</span>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <span class="status" [class]="getStatusClass(mission.status)">
                                    {{ mission.status }}
                                </span>
                            </td>
                            <td>
                                <span class="crew" [class.full]="isFull(mission)">
                                    Crew: {{ mission.crew_count }}{{ mission.max_participants > 0 ? ' / ' +
                                    mission.max_participants : '' }}
                                </span>
                            </td>
                            <td class="date">{{ mission.created_at | date:'d MMM yyyy, h:mm a':'+0700' }}</td>
                            <td>
                                <div class="actions">
                                    <button class="action-btn" title="View" (click)="openViewModal(mission)">
                                        View
                                    </button>
                                    @if (isInMission(mission.id)) {
                                    <button class="action-btn leave" title="Leave" (click)="leaveMission(mission)"
                                        [disabled]="isProcessing() || mission.status !== 'Open'"
                                        [title]="mission.status !== 'Open' ? 'Cannot leave once started' : 'Leave'">
                                        Leave
                                    </button>
                                    } @else {
                                    <button class="action-btn join" title="Join" (click)="joinMission(mission)"
                                        [disabled]="isProcessing() || currentMissionId() !== null"
                                        [title]="currentMissionId() !== null ? 'Already in a mission' : 'Join'">
                                        Join
                                    </button>
                                    }
                                </div>
                            </td>
                        </tr>
                        }
                    </tbody>
                </table>
            </div>

            <div class="mobile-grid">
                @for (mission of filteredMissions(); track mission.id) {
                <div class="mission-card-mobile" (click)="openViewModal(mission)">
                    <div class="card-top">
                        <span class="room-code">#{{ mission.code }}</span>
                        <span class="status" [class]="getStatusClass(mission.status)">{{ mission.status }}</span>
                    </div>
                    <div class="card-mid">
                        <div class="mission-info">
                            <span class="name">{{ mission.name }}</span>
                            <span class="desc">{{ mission.description || 'No description' }}</span>
                        </div>
                    </div>
                    <div class="card-bottom">
                        <span class="crew" [class.full]="isFull(mission)">Crew: {{ mission.crew_count }}{{
                            mission.max_participants > 0 ? ' / ' +
                            mission.max_participants : '' }}</span>
                        <div class="card-actions" (click)="$event.stopPropagation()">
                            @if (isInMission(mission.id)) {
                            <button class="action-btn leave" (click)="leaveMission(mission)"
                                [disabled]="isProcessing() || mission.status !== 'Open'">Leave</button>
                            } @else {
                            <button class="action-btn join" (click)="joinMission(mission)"
                                [disabled]="isProcessing() || currentMissionId() !== null">Join</button>
                            }
                        </div>
                    </div>
                </div>
                }
            </div>
            }
            }

            <!-- Participating Missions -->
            @if (selectedTabIndex === 1) {
            @if (isLoadingMyMissions()) {
            <div class="loading-state">
                <div class="spinner"></div>
                <p>Loading participating missions...</p>
            </div>
            } @else if (joinedMissions().length === 0) {
            <div class="empty-state">
                <h3>You haven't joined any missions yet</h3>
                <p>Explore the mission list to find a squad to join!</p>
            </div>
            } @else {
            <div class="table-wrapper desktop-only">
                <table class="joined-table">
                    <thead>
                        <tr>
                            <th>Room ID</th>
                            <th>Mission</th>
                            <th>Status</th>
                            <th>Crew</th>
                            <th>Leader</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        @for (mission of joinedMissions(); track mission.id) {
                        <tr [class.in-mission]="isInMission(mission.id)">
                            <td class="code-cell">
                                <span class="room-code">#{{ mission.code }}</span>
                            </td>
                            <td>
                                <div class="mission-cell">
                                    @if (mission.image_url) {
                                    <div class="mission-icon has-image">
                                        <img [src]="mission.image_url" alt="Mission" />
                                    </div>
                                    }
                                    <div class="mission-info">
                                        <span class="name">{{ mission.name }}</span>
                                        <span class="desc">{{ mission.description || 'No description' }}</span>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <span class="status" [class]="getStatusClass(mission.status)">
                                    {{ mission.status }}
                                </span>
                            </td>
                            <td>
                                <span class="crew" [class.full]="isFull(mission)">
                                    Crew: {{ mission.crew_count }}{{ mission.max_participants > 0 ? ' / ' +
                                    mission.max_participants : '' }}
                                </span>
                            </td>
                            <td class="leader-cell">
                                <span class="leader-name">{{ mission.chief_name }}</span>
                            </td>
                            <td>
                                <div class="actions">
                                    <button class="action-btn" title="View" (click)="openViewModal(mission)">
                                        View
                                    </button>
                                    <button class="action-btn leave" title="Leave" (click)="leaveMission(mission)"
                                        [disabled]="isProcessing() || mission.status !== 'Open'"
                                        [title]="mission.status !== 'Open' ? 'Cannot leave once started' : 'Leave'">
                                        Leave
                                    </button>
                                </div>
                            </td>
                        </tr>
                        }
                    </tbody>
                </table>
            </div>

            <div class="mobile-grid">
                @for (mission of joinedMissions(); track mission.id) {
                <div class="mission-card-mobile" (click)="openViewModal(mission)">
                    <div class="card-top">
                        <span class="room-code">#{{ mission.code }}</span>
                        <span class="status" [class]="getStatusClass(mission.status)">{{ mission.status }}</span>
                    </div>
                    <div class="card-mid">
                        <div class="mission-info">
                            <span class="name">{{ mission.name }}</span>
                            <span class="desc">{{ mission.description || 'No description' }}</span>
                        </div>
                    </div>
                    <div class="card-bottom">
                        <span class="crew" [class.full]="isFull(mission)">Crew: {{ mission.crew_count }}{{
                            mission.max_participants > 0 ? ' / ' +
                            mission.max_participants : '' }}</span>
                        <span class="leader-name">{{ mission.chief_name }}</span>
                        <div class="card-actions" (click)="$event.stopPropagation()">
                            <button class="action-btn" (click)="openViewModal(mission)">View</button>
                            <button class="action-btn leave" (click)="leaveMission(mission)"
                                [disabled]="isProcessing()">Leave</button>
                        </div>
                    </div>
                </div>
                }
            </div>
            }
            }

            <!-- My Missions -->
            @if (selectedTabIndex === 2) {
            @if (isLoadingMyMissions()) {
            <div class="loading-state">
                <div class="spinner"></div>
                <p>Loading your missions...</p>
            </div>
            } @else if (myMissions().length === 0) {
            <div class="empty-state">
                <h3>You haven't created any missions yet</h3>
                <p>Click "Create Mission" in the navbar to get started!</p>
            </div>
            } @else {
            <div class="table-wrapper desktop-only">
                <table class="my-table">
                    <thead>
                        <tr>
                            <th>Room ID</th>
                            <th>Mission</th>
                            <th>Status</th>
                            <th>Crew</th>
                            <th>Created</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        @for (mission of myMissions(); track mission.id) {
                        <tr>
                            <td class="code-cell">
                                <span class="room-code">#{{ mission.code }}</span>
                            </td>
                            <td>
                                <div class="mission-cell">
                                    @if (mission.image_url) {
                                    <div class="mission-icon has-image">
                                        <img [src]="mission.image_url" alt="Mission" />
                                    </div>
                                    }
                                    <div class="mission-info">
                                        <span class="name">{{ mission.name }}</span>
                                        <span class="desc">{{ mission.description || 'No description' }}</span>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <span class="status" [class]="getStatusClass(mission.status)">
                                    {{ mission.status }}
                                </span>
                            </td>
                            <td>
                                <span class="crew" [class.full]="isFull(mission)">
                                    Crew: {{ mission.crew_count }}{{ mission.max_participants > 0 ? ' / ' +
                                    mission.max_participants : '' }}
                                </span>
                            </td>
                            <td class="date">{{ mission.created_at | date:'d MMM yyyy, h:mm a':'+0700' }}</td>
                            <td>
                                <div class="actions">
                                    <button class="action-btn" title="View" (click)="openViewModal(mission)">
                                        View
                                    </button>
                                    <button class="action-btn edit" title="Edit" (click)="openEditModal(mission)">
                                        Edit
                                    </button>
                                    <button class="action-btn delete" title="Delete" (click)="openDeleteModal(mission)">
                                        Delete
                                    </button>
                                </div>
                            </td>
                        </tr>
                        }
                    </tbody>
                </table>
            </div>

            <div class="mobile-grid">
                @for (mission of myMissions(); track mission.id) {
                <div class="mission-card-mobile" (click)="openViewModal(mission)">
                    <div class="card-top">
                        <span class="room-code">#{{ mission.code }}</span>
                        <span class="status" [class]="getStatusClass(mission.status)">{{ mission.status }}</span>
                    </div>
                    <div class="card-mid">
                        <div class="mission-info">
                            <span class="name">{{ mission.name }}</span>
                            <span class="desc">{{ mission.description || 'No description' }}</span>
                        </div>
                    </div>
                    <div class="card-bottom">
                        <span class="crew" [class.full]="isFull(mission)">Crew: {{ mission.crew_count }}{{
                            mission.max_participants > 0 ? ' / ' +
                            mission.max_participants : '' }}</span>
                        <div class="card-actions" (click)="$event.stopPropagation()">
                            <button class="action-btn" (click)="openViewModal(mission)">View</button>
                            <button class="action-btn edit" (click)="openEditModal(mission)">Edit</button>
                            <button class="action-btn delete" (click)="openDeleteModal(mission)">Delete</button>
                        </div>
                    </div>
                </div>
                }
            </div>
            }
            }

            <!-- Mission History (Finished) -->
            @if (selectedTabIndex === 3) {
            @if (isLoadingFinishedMissions()) {
            <div class="loading-state">
                <div class="spinner"></div>
                <p>Loading mission history...</p>
            </div>
            } @else if (finishedMissions().length === 0) {
            <div class="empty-state">
                <h3>No finished missions yet</h3>
                <p>Complete or fail missions to see them here!</p>
            </div>
            } @else {
            <!-- History Filter Bar -->
            <div class="history-filter-bar">
                <button class="history-filter-btn" [class.active]="historyFilter() === 'all'"
                    (click)="historyFilter.set('all')">
                    All
                    <span class="hf-count">{{ finishedMissions().length }}</span>
                </button>
                <button class="history-filter-btn completed" [class.active]="historyFilter() === 'Completed'"
                    (click)="historyFilter.set('Completed')">
                    ✓ Completed
                    <span class="hf-count">{{ historyCompletedCount() }}</span>
                </button>
                <button class="history-filter-btn failed" [class.active]="historyFilter() === 'Failed'"
                    (click)="historyFilter.set('Failed')">
                    ✕ Failed
                    <span class="hf-count">{{ historyFailedCount() }}</span>
                </button>
            </div>
            <div class="table-wrapper desktop-only">
                <table class="finished-table">
                    <thead>
                        <tr>
                            <th>Room ID</th>
                            <th>Mission</th>
                            <th>Status</th>
                            <th>Crew</th>
                            <th>Leader</th>
                            <th>Date</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        @for (mission of filteredHistory(); track mission.id) {
                        <tr>
                            <td class="code-cell">
                                <span class="room-code">#{{ mission.code }}</span>
                            </td>
                            <td>
                                <div class="mission-cell">
                                    @if (mission.image_url) {
                                    <div class="mission-icon has-image">
                                        <img [src]="mission.image_url" alt="Mission" />
                                    </div>
                                    }
                                    <div class="mission-info">
                                        <span class="name">{{ mission.name }}</span>
                                        <span class="desc">{{ mission.description || 'No description' }}</span>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <span class="status" [class]="getStatusClass(mission.status)">
                                    {{ mission.status }}
                                </span>
                            </td>
                            <td>
                                <span class="crew" [class.full]="isFull(mission)">
                                    Crew: {{ mission.crew_count }}{{ mission.max_participants > 0 ? ' / ' +
                                    mission.max_participants : '' }}
                                </span>
                            </td>
                            <td class="leader-cell">
                                <span class="leader-name">{{ mission.chief_name }}</span>
                            </td>
                            <td class="date">{{ mission.updated_at | date:'d MMM yyyy, h:mm a':'+0700' }}</td>
                            <td>
                                <div class="actions">
                                    <button class="action-btn" title="View" (click)="openViewModal(mission)">
                                        View
                                    </button>
                                </div>
                            </td>
                        </tr>
                        }
                    </tbody>
                </table>
            </div>

            <div class="mobile-grid">
                @for (mission of filteredHistory(); track mission.id) {
                <div class="mission-card-mobile" (click)="openViewModal(mission)">
                    <div class="card-top">
                        <span class="room-code">#{{ mission.code }}</span>
                        <span class="status" [class]="getStatusClass(mission.status)">{{ mission.status }}</span>
                    </div>
                    <div class="card-mid">
                        <div class="mission-info">
                            <span class="name">{{ mission.name }}</span>
                            <span class="desc">{{ mission.description || 'No description' }}</span>
                        </div>
                    </div>
                    <div class="card-bottom">
                        <span class="crew" [class.full]="isFull(mission)">Crew: {{ mission.crew_count }}{{
                            mission.max_participants > 0 ? ' / ' +
                            mission.max_participants : '' }}</span>
                        <span class="leader-name">{{ mission.chief_name }}</span>
                    </div>
                </div>
                }
            </div>
            }
            }
        </div>
    </div>
</div>

<!-- View Modal -->
@if (showViewModal()) {
<div class="modal-overlay" (click)="closeViewModal()">
    <div class="modal modal-premium" (click)="$event.stopPropagation()">
        <!-- Premium Header Hero -->
        @if (selectedMission(); as mission) {
        <div class="modal-hero">
            <div class="hero-content">
                <div class="mission-status-pill" [class]="getStatusClass(mission.status)">
                    <span class="status-dot"></span>
                    {{ mission.status }}
                </div>
                <h2 class="hero-title">{{ mission.name }}</h2>
                <div class="room-id-badge">
                    <span class="room-label">CORE ID</span>
                    <span class="room-val">#{{ mission.code }}</span>
                </div>
            </div>
            <button class="close-btn-floating" (click)="closeViewModal()">×</button>
        </div>

        <div class="modal-body-premium">
            <!-- Sidebar: Mission Info -->
            <div class="mission-main-info">
                <div class="info-grid">
                    <div class="info-item">
                        <div class="info-text">
                            <span class="info-label">Objective</span>
                            <span class="info-value">{{ mission.description || 'Confidential objective' }}</span>
                        </div>
                    </div>
                    <div class="info-item">
                        <div class="info-text">
                            <span class="info-label">Commander</span>
                            <span class="info-value">{{ mission.chief_name }}</span>
                        </div>
                    </div>
                    <div class="info-item">
                        <div class="info-text">
                            <span class="info-label">Created</span>
                            <span class="info-value">{{ mission.created_at | date:'d MMM yyyy, h:mm a':'+0700' }}</span>
                        </div>
                    </div>
                </div>

                <!-- Mission Operations for Chief -->
                @if (isLeader(mission)) {
                <div class="op-panel">
                    <span class="op-label">Operational Authority</span>
                    <div class="op-actions">
                        @if (mission.status === 'Open') {
                        <button class="btn-premium-op start" (click)="startMission(mission.id)"
                            [disabled]="isProcessing() || mission.crew_count === 0 || isOverLimit(mission)"
                            [title]="isOverLimit(mission) ? 'Cannot start: Crew exceeds limit' : ''">
                            Start Mission
                        </button>
                        } @else if (mission.status === 'InProgress') {
                        <button class="btn-premium-op success" (click)="completeMission(mission.id)"
                            [disabled]="isProcessing()">
                            Mission Success
                        </button>
                        <button class="btn-premium-op fail" (click)="failMission(mission.id)"
                            [disabled]="isProcessing()">
                            Fail
                        </button>
                        }
                    </div>
                </div>
                }
            </div>

            <!-- Main Content: Crew & Invitations -->
            <div class="mission-social-sections">
                <!-- Crew Members -->
                <div class="social-card">
                    <div class="card-header">
                        <h3>Crew Members</h3>
                        <span class="member-count" [class.is-over]="isFull(mission)">
                            {{ mission.crew_count }}{{ mission.max_participants > 0 ? ' / ' +
                            mission.max_participants : '' }} Active
                        </span>
                    </div>

                    <div class="member-list-scroll">
                        @if (loadingCrew() && crewMembers().length === 0) {
                        <div class="loading-micro">
                            <div class="dots"></div>
                        </div>
                        } @else {
                        @for (member of crewMembers(); track member.brawler_id) {
                        <div class="member-card-premium" [class.is-leader]="member.brawler_id === mission.chief_id">
                            <div class="member-avatar-wrapper">
                                <img [src]="member.avatar_url || 'assets/defaultavtar.jpg'"
                                    (error)="$any($event.target).src = 'assets/defaultavtar.jpg'"
                                    class="premium-avatar">
                                @if (member.brawler_id === mission.chief_id) {
                                <div class="leader-crown">⭐</div>
                                }
                            </div>
                            <div class="member-meta">
                                <a [routerLink]="['/u', member.username]" class="member-name">{{ member.display_name
                                    }}</a>
                                <span class="member-stats">{{ member.mission_success_count }}W · {{
                                    member.mission_joined_count }}J</span>
                            </div>
                            @if (isLeader(mission) && member.brawler_id !== mission.chief_id && mission.status !==
                            'Completed' && mission.status !== 'Failed') {
                            <button class="kick-btn-minimal" (click)="kickMember(member.brawler_id)"
                                title="Kick member">×</button>
                            }
                        </div>
                        } @empty {
                        <div class="empty-state-micro">No crew members assembled.</div>
                        }
                        }
                    </div>
                </div>

                <!-- Invite Section - Only for active missions -->
                @if ((isInMission(mission.id) || isLeader(mission)) && (mission.status === 'Open' || mission.status ===
                'InProgress')) {
                <div class="social-card">
                    <div class="card-header">
                        <h3>Send Invitations</h3>
                        <span class="hint-text">Invite your friends to the squad</span>
                    </div>

                    <div class="member-list-scroll">
                        @for (friend of friendsWithCooldown(); track friend.friend_id) {
                        <div class="invite-card-premium">
                            <img [src]="friend.avatar_url || 'assets/defaultavtar.jpg'"
                                (error)="$any($event.target).src = 'assets/defaultavtar.jpg'"
                                class="premium-avatar-small">
                            <span class="friend-name">{{ friend.display_name }}</span>

                            <div class="invite-status-cell">
                                @if (isMember(friend.friend_id)) {
                                <span class="pill pill-joined">In Crew</span>
                                } @else if (isInvited(friend.friend_id)) {
                                @if (friend.isCooldown) {
                                <span class="pill pill-pending">Pending...</span>
                                } @else {
                                <button class="btn-invite-premium retry"
                                    (click)="inviteFriend(friend.friend_id)">Resend</button>
                                }
                                } @else {
                                <button class="btn-invite-premium" (click)="inviteFriend(friend.friend_id)"
                                    [disabled]="isFull(mission) || friend.current_mission_id !== null"
                                    [title]="friend.current_mission_id !== null ? 'Friend is in another mission' : (isFull(mission) ? 'Mission is full' : 'Invite')">
                                    {{ friend.current_mission_id !== null ? 'Occupied' : 'Invite' }}
                                </button>
                                }
                            </div>
                        </div>
                        } @empty {
                        <div class="empty-state-micro">No friends available to invite.</div>
                        }
                    </div>
                </div>
                }
            </div>
        </div>
        }
    </div>
</div>
}

<!-- Edit Modal -->
@if (showEditModal()) {
<div class="modal-overlay" (click)="closeEditModal()">
    <div class="modal" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h2>Edit Mission</h2>
            <button class="close-btn" (click)="closeEditModal()">
                <span>X</span>
            </button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label for="edit-name">Mission Name</label>
                <input type="text" id="edit-name" [(ngModel)]="editName" placeholder="Enter mission name" />
            </div>
            <div class="form-group">
                <label for="edit-desc">Description</label>
                <textarea id="edit-desc" [(ngModel)]="editDescription" placeholder="Enter description"
                    rows="4"></textarea>
            </div>
            <div class="form-group">
                <label for="edit-max">Max Participants (0 for unlimited)</label>
                <div class="numeric-input-wrapper">
                    <input type="number" id="edit-max" [(ngModel)]="editMaxParticipants" min="0"
                        class="numeric-input" />
                    <div class="numeric-hint">Enter 0 for no limit</div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-secondary" (click)="closeEditModal()">Cancel</button>
            <button class="btn-primary" (click)="submitEdit()" [disabled]="isProcessing()">
                {{ isProcessing() ? 'Saving...' : 'Save Changes' }}
            </button>
        </div>
    </div>
</div>
}

<!-- Delete Modal -->
@if (showDeleteModal()) {
<div class="modal-overlay" (click)="closeDeleteModal()">
    <div class="modal" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h2>Delete Mission</h2>
            <button class="close-btn" (click)="closeDeleteModal()">
                <span>X</span>
            </button>
        </div>
        <div class="modal-body">
            <p>Are you sure you want to delete mission "{{ selectedMission()?.name }}"?</p>
            <p class="warning-text">This action cannot be undone.</p>
        </div>
        <div class="modal-footer">
            <button class="btn-secondary" (click)="closeDeleteModal()">Cancel</button>
            <button class="btn-danger" (click)="confirmDelete()" [disabled]="isProcessing()">
                {{ isProcessing() ? 'Deleting...' : 'Delete Mission' }}
            </button>
        </div>
    </div>
</div>
}